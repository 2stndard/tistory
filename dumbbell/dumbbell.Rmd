---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 벗꽃피는 순서대로 망한다? 지역별 대학생수 변동 - dumbbell 차트

덤벨(Dumbbell) 차트는 동일한 변수의 두개의 값을  비교하기 위해 사용하는 차트이다. 일반적으로 양쪽 끝을 둥글게 만들고 그 사이를 선으로 연결하여 생긴 형태가 운동할때 쓰는 아령과 같이 생겨서 붙여진 이름이다. 

`ggplot2`를 사용하여 덤벨 차트를 만들때는 

1. `ggalt` 패키지의 `geom_dumbbell()`을 이용하는 방법
2. `geom_line()`을 사용하는 방법
3. `geom_segment()`를 사용하는 방법의 세가지 방법을 사용할 수 있다. 

이번 포스트에서는 이 세가지 방법을 모두 사용하여 덤벨 차트를 만들어 본다. 

최근 저출산 고령화 사회로 진입함에 따라 점차 신생아수가 지속적으로 줄어들었다. 이러한 신생아수 감소가 2020년부터 본격적으로 대학 학생수에 영향을 미치기 시작했는데 이러한 현상으로 '벗꽂 피는 순서대로 대학이 망한다'는 이야기가 나오고 있다. 

덤벨 차트를 사용하여 2019년과 2020년의 각 지역별 대학 학생수를 비교해보도록 하겠다. 

실습에 사용하는 데이터는 교육통계 서비스 홈페이지 <https://kess.kedi.re.kr>에서 제공하는 [대학 시도별 학생수](https://kess.kedi.re.kr/kessTheme/timeStats?itemCode=03&uppCd1=03040106&menuId=m_02_03_02#testinput)를 사용하였다.

### 데이터 로딩 및 전처리

[대학 시도별 학생수](https://kess.kedi.re.kr/kessTheme/timeStats?itemCode=03&uppCd1=03040106&menuId=m_02_03_02#testinput)에서 다운받은 파일(대학 시도별 학생수.xlsx)의 데이터를 로딩하면 다음과 같다.



```{r import}
library(readxl)

#  엑셀 파일을 읽어 df 데이터프레임에 로딩
df <- read_excel('./dumbbell/대학 시도별 학생수.xlsx', na = '-', sheet = 'Sheet0', col_types = c(rep('numeric', 19)), col_names = T)

# df 중에서 필요없는 행을 삭제
df <- df[-(42:49),]

# 덤벨 차트 생성에 필요한 rate.df를 만든다. 
rate.df <- df |> 
  ## 연도가 2019년 이상만 필터링
  filter(연도 >= 2019) |>       
  ## 2번열부터 19번 열까지를 긴형태의 데이터 프레임으로 변환
  gather(key = '지역', value = '학생수', 2:19) |>
  ## 긴형태로 변환된 데이터프레임을 다시 2019열과 2020열을 만들어 넓은 형태로 변환
  spread(key = 연도, value = 학생수) |>
  ## 2019년 대비 2020년 학생수 비율이 저장된 열과 증가/감소가 표현되는 열을 생성
  mutate(rate = (`2020`/`2019`)*100, rate1 = 100, pos = ifelse(rate >= 100, '증가', '감소')) |>
  ## 차트 생성에 필요한 열만 선택
  select(1, 4, 5, 6)

## 열 이름을 변경
colnames(rate.df) <- c('지역', '2020', '2019', 'pos')

rate.df$지역 <- fct_relevel(rate.df$지역, '합계', '서울', '부산', '대구', '인천', '광주', '대전', '울산', '세종', '경기', '강원', '충북', '충남', '전북', '전남', '경북', '경남', '제주')
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
